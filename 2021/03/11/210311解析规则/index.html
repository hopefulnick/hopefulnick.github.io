<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="ANTLR 4," />










<meta name="description" content="1 解析规则Java应用通过调用生成的规则函数使用。 规则间使用分号分隔，选项间使用中竖线分隔。 选项为空，表示整个规则可不匹配。">
<meta name="keywords" content="ANTLR 4">
<meta property="og:type" content="article">
<meta property="og:title" content="ANTLR 4解析规则">
<meta property="og:url" content="https://hopefulnick.github.io/2021/03/11/210311解析规则/index.html">
<meta property="og:site_name" content="Hopeful Nick">
<meta property="og:description" content="1 解析规则Java应用通过调用生成的规则函数使用。 规则间使用分号分隔，选项间使用中竖线分隔。 选项为空，表示整个规则可不匹配。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://github.com/antlr/antlr4/raw/master/doc/images/xyz.png">
<meta property="og:image" content="https://github.com/antlr/antlr4/raw/master/doc/images/xyz_opt.png">
<meta property="og:image" content="https://github.com/antlr/antlr4/raw/master/doc/images/xyz_star.png">
<meta property="og:image" content="https://github.com/antlr/antlr4/raw/master/doc/images/xyz_plus.png">
<meta property="og:updated_time" content="2022-06-06T07:24:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ANTLR 4解析规则">
<meta name="twitter:description" content="1 解析规则Java应用通过调用生成的规则函数使用。 规则间使用分号分隔，选项间使用中竖线分隔。 选项为空，表示整个规则可不匹配。">
<meta name="twitter:image" content="https://github.com/antlr/antlr4/raw/master/doc/images/xyz.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://hopefulnick.github.io/2021/03/11/210311解析规则/"/>





  <title>ANTLR 4解析规则 | Hopeful Nick</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hopeful Nick</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hopefulnick.github.io/2021/03/11/210311解析规则/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hopeful Nick">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hopeful Nick">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ANTLR 4解析规则</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-11T11:00:47+08:00">
                2021-03-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANTLR-4/" itemprop="url" rel="index">
                    <span itemprop="name">ANTLR 4</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/11/210311解析规则/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/11/210311解析规则/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="1-解析规则"><a href="#1-解析规则" class="headerlink" title="1 解析规则"></a>1 解析规则</h2><p>Java应用通过调用生成的规则函数使用。</p>
<p>规则间使用分号分隔，选项间使用中竖线分隔。</p>
<p>选项为空，表示整个规则可不匹配。<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">superClass</span><br><span class="line"> 	: &apos;extends&apos; ID</span><br><span class="line"> 	| // empty means other alternative(s) are optional</span><br><span class="line"> 	;</span><br></pre></td></tr></table></figure></p>
<h2 id="2-选项标签"><a href="#2-选项标签" class="headerlink" title="2 选项标签"></a>2 选项标签</h2><p>用于生成详细的解析树监听事件。</p>
<p>使用#标记，要么全部标记，要么全不标记。</p>
<p>标签名不能与规则名相同。</p>
<p>标签不必在行尾。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">grammar T;</span><br><span class="line">stat: &apos;return&apos; e &apos;;&apos; # Return</span><br><span class="line"> 	| &apos;break&apos; &apos;;&apos; # Break</span><br><span class="line"> 	;</span><br><span class="line">e   : e &apos;*&apos; e # Mult</span><br><span class="line">    | e &apos;+&apos; e # Add</span><br><span class="line">    | INT # Int</span><br><span class="line">    ;</span><br></pre></td></tr></table></figure>
<p>以下为生成的规则上下文类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AListener</span> <span class="keyword">extends</span> <span class="title">ParseTreeListener</span> </span>&#123;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">enterReturn</span><span class="params">(AParser.ReturnContext ctx)</span></span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">exitReturn</span><span class="params">(AParser.ReturnContext ctx)</span></span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">enterBreak</span><span class="params">(AParser.BreakContext ctx)</span></span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">exitBreak</span><span class="params">(AParser.BreakContext ctx)</span></span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">enterMult</span><span class="params">(AParser.MultContext ctx)</span></span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">exitMult</span><span class="params">(AParser.MultContext ctx)</span></span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">enterAdd</span><span class="params">(AParser.AddContext ctx)</span></span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">exitAdd</span><span class="params">(AParser.AddContext ctx)</span></span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">enterInt</span><span class="params">(AParser.IntContext ctx)</span></span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">exitInt</span><span class="params">(AParser.IntContext ctx)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以重复使用标签，意味着触发相同的事件。</p>
<h2 id="3-规则上下文对象"><a href="#3-规则上下文对象" class="headerlink" title="3 规则上下文对象"></a>3 规则上下文对象</h2><p>对应规则的解析树节点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inc : e &apos;++&apos; ;</span><br></pre></td></tr></table></figure>
<p>对应的上下文对象如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IncContext</span> <span class="keyword">extends</span> <span class="title">ParserRuleContext</span> </span>&#123;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> EContext <span class="title">e</span><span class="params">()</span> </span>&#123; ... &#125; <span class="comment">// return context object associated with e</span></span><br><span class="line"> 	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当规则被引用多次时，将生成通过索引访问应用上下文的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">field : e &apos;.&apos; e ;</span><br></pre></td></tr></table></figure>
<p>生成方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldContext</span> <span class="keyword">extends</span> <span class="title">ParserRuleContext</span> </span>&#123;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> EContext <span class="title">e</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123; ... &#125; <span class="comment">// get ith e context</span></span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> List&lt;EContext&gt; <span class="title">e</span><span class="params">()</span> </span>&#123; ... &#125; <span class="comment">// return ALL e contexts</span></span><br><span class="line"> 	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他的规则可在内嵌动作中访问匹配的上下文列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 规则s引用了field.</span><br><span class="line">s : field</span><br><span class="line"> 	&#123;</span><br><span class="line"> 	List&lt;EContext&gt; x = $field.ctx.e();</span><br><span class="line"> 	...</span><br><span class="line"> 	&#125;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>监听器和访问器也可以通过形如f.e()的方式访问。</p>
<h2 id="4-规则元素标记"><a href="#4-规则元素标记" class="headerlink" title="4 规则元素标记"></a>4 规则元素标记</h2><p>使用=添加字段到规则对象中，+=添加字段列表到规则对象中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 返回值标记</span><br><span class="line">stat: &apos;return&apos; value=e &apos;;&apos; # Return</span><br><span class="line"> 	| &apos;break&apos; &apos;;&apos; # Break</span><br><span class="line"> 	;</span><br><span class="line"></span><br><span class="line">// token标记</span><br><span class="line">array : &apos;&#123;&apos; el+=INT (&apos;,&apos; el+=INT)* &apos;&#125;&apos; ;</span><br><span class="line"></span><br><span class="line">// 上下文对象标记</span><br><span class="line">elist : exprs+=e (&apos;,&apos; exprs+=e)* ;</span><br></pre></td></tr></table></figure>
<p>生成字段如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnContext</span> <span class="keyword">extends</span> <span class="title">StatContext</span> </span>&#123;</span><br><span class="line"> 	<span class="keyword">public</span> EContext value;</span><br><span class="line"> 	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayContext</span> <span class="keyword">extends</span> <span class="title">ParserRuleContext</span> </span>&#123;</span><br><span class="line"> 	<span class="keyword">public</span> List&lt;Token&gt; el = <span class="keyword">new</span> ArrayList&lt;Token&gt;();</span><br><span class="line"> 	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ElistContext</span> <span class="keyword">extends</span> <span class="title">ParserRuleContext</span> </span>&#123;</span><br><span class="line"> 	<span class="keyword">public</span> List&lt;EContext&gt; exprs = <span class="keyword">new</span> ArrayList&lt;EContext&gt;();</span><br><span class="line"> 	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-规则元素"><a href="#5-规则元素" class="headerlink" title="5 规则元素"></a>5 规则元素</h2><p>指定parser在某一时刻的特定行为。</p>
<table>
<thead>
<tr>
<th>Syntax</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>T</td>
<td>token, 大写开头</td>
</tr>
<tr>
<td>’literal’</td>
<td>字面量，固定值</td>
</tr>
<tr>
<td>r</td>
<td>规则，小写开头</td>
</tr>
<tr>
<td>r [«args»]</td>
<td>带参规则，参数按逗号分隔，按目标语言表示</td>
</tr>
<tr>
<td>{«action»}</td>
<td>Execute an action immediately after the preceding alternative element and immediately before the following alternative element. The action conforms to the syntax of the target language. ANTLR copies the action code to the generated class verbatim, except for substituting attribute and token references such as $x and $x.y.在前后规则选项间立即执行动作。按照目标语言表示。代码逐字拷贝进生成的类文件，除了附属的属性和标识x和x.y</td>
</tr>
<tr>
<td>{«p»}?</td>
<td>Evaluate semantic predicate «p». Do not continue parsing past a predicate if «p» evaluates to false at runtime. Predicates encountered during prediction, when ANTLR distinguishes between alternatives, enable or disable the alternative(s) surrounding the predicate(s).</td>
</tr>
<tr>
<td>.</td>
<td>通配符</td>
</tr>
</tbody>
</table>
<p>此外，～表示非，如～INT表示除了INT外的标识。</p>
<h2 id="6-子规则"><a href="#6-子规则" class="headerlink" title="6 子规则"></a>6 子规则</h2><p>如同括号包围的没有名称的规则，不能定义本地属性。</p>
<p>通常有以下4类子规则：</p>
<table>
<thead>
<tr>
<th>Syntax</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/antlr/antlr4/blob/master/doc/images/xyz.png" target="_blank" rel="noopener"><img src="https://github.com/antlr/antlr4/raw/master/doc/images/xyz.png" alt="img"></a></td>
<td>(x\</td>
<td>y\</td>
<td>z). Match any alternative within the subrule exactly once. Example: `returnType : (type</td>
<td>‘void’) ;`</td>
</tr>
<tr>
<td><a href="https://github.com/antlr/antlr4/blob/master/doc/images/xyz_opt.png" target="_blank" rel="noopener"><img src="https://github.com/antlr/antlr4/raw/master/doc/images/xyz_opt.png" alt="img"></a></td>
<td>(x\</td>
<td>y\</td>
<td>z)? Match nothing or any alternative within subrule. Example: <code>classDeclaration : &#39;class&#39; ID (typeParameters)? (&#39;extends&#39; type)? (&#39;implements&#39; typeList)? classBody ;</code></td>
</tr>
<tr>
<td><a href="https://github.com/antlr/antlr4/blob/master/doc/images/xyz_star.png" target="_blank" rel="noopener"><img src="https://github.com/antlr/antlr4/raw/master/doc/images/xyz_star.png" alt="img"></a></td>
<td>(x\</td>
<td>y\</td>
<td>z)<em> Match an alternative within subrule zero or more times. Example: `annotationName : ID (‘.’ ID)</em> ;`</td>
</tr>
<tr>
<td><a href="https://github.com/antlr/antlr4/blob/master/doc/images/xyz_plus.png" target="_blank" rel="noopener"><img src="https://github.com/antlr/antlr4/raw/master/doc/images/xyz_plus.png" alt="img"></a></td>
<td>(x\</td>
<td>y\</td>
<td>z)+ Match an alternative within subrule one or more times. Example: <code>annotations : (annotation)+ ;</code></td>
</tr>
</tbody>
</table>
<p>其中，？也可以用于取消贪婪模式，如<code>??</code>只用一个子规则时，可以省略括号。如ID+表示(ID)+</p>
<h2 id="7-异常捕获"><a href="#7-异常捕获" class="headerlink" title="7 异常捕获"></a>7 异常捕获</h2><p>每条规则都被try/catch/finally包装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">void r() throws RecognitionException &#123;</span><br><span class="line"> 	try &#123;</span><br><span class="line"> 		rule-body</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	catch (RecognitionException re) &#123;</span><br><span class="line">	 	_errHandler.reportError(this, re);</span><br><span class="line">	 	_errHandler.recover(this, re);</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	finally &#123;</span><br><span class="line">		exitRule();</span><br><span class="line"> 	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以使用策略对象修改全局行为，也可以对一条规则单独定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r : ...</span><br><span class="line">  ;</span><br><span class="line">  catch[FailedPredicateException fpe] &#123; ... &#125;</span><br><span class="line">  catch[RecognitionException e] &#123; ... &#125;</span><br><span class="line">  finally &#123; System.out.println(&quot;exit rule r&quot;); &#125;</span><br></pre></td></tr></table></figure>
<p>全部异常如下：</p>
<table>
<thead>
<tr>
<th>Exception name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>RecognitionException</td>
<td>RuntimeException的子类，其他异常的父类</td>
</tr>
<tr>
<td>NoViableAltException</td>
<td>无法决定解析路径</td>
</tr>
<tr>
<td>LexerNoViableAltException</td>
<td>仅用于词法解析</td>
</tr>
<tr>
<td>InputMismatchException</td>
<td>当前token与解析器期望不一致</td>
</tr>
<tr>
<td>FailedPredicateException</td>
<td>A semantic predicate that evaluates to false during prediction renders the surrounding alternative nonviable. Prediction occurs when a rule is predicting which alternative to take. If all viable paths disappear, parser will throw NoViableAltException. This predicate gets thrown by the parser when a semantic predicate evaluates to false outside of prediction, during the normal parsing process of matching tokens and calling rules.</td>
</tr>
</tbody>
</table>
<h2 id="8-规则属性定义"><a href="#8-规则属性定义" class="headerlink" title="8 规则属性定义"></a>8 规则属性定义</h2><p>规则可以有入参、返回值和本地变量，使用逗号分隔。其定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rulename[args] returns [retvals] locals [localvars] : ... ;</span><br></pre></td></tr></table></figure>
<p>方括号中的变量可以和其他变量一样被引用，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// Return the argument plus the integer value of the INT token</span><br><span class="line">add[int x] returns [int result] : &apos;+=&apos; INT &#123;$result = $x + $INT.int;&#125; ;</span><br></pre></td></tr></table></figure>
<p>可以赋初值。但不要在手动解析泛型文本时过度使用，如<a href="https://github.com/antlr/antlr4/blob/master/tool/src/org/antlr/v4/parse/ScopeParser.java" target="_blank" rel="noopener">ScopeParser</a></p>
<p>在不同的的语言中略有不同：</p>
<p>C++中使用数组引用来定义整型；Go和Swift需要交换类型和变量名；GO需要使用冒号分隔类型和变量名；Python和JavaScript不需要声明类型。</p>
<p>技术上，以上变量声明方式可以互换，如<a href="https://github.com/antlr/antlr4/blob/master/tool-testsuite/test/org/antlr/v4/test/tool/TestScopeParsing.java" target="_blank" rel="noopener">TestScopeParsing</a></p>
<p>从语法层面上，可以定义两种规则级别的命名动作：init和after，分别在规则匹配前和后执行。注意after不是finally的一部分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">** Derived from rule &quot;row : field (&apos;,&apos; field)* &apos;\r&apos;? &apos;\n&apos; ;&quot; */</span><br><span class="line">row[String[] columns]</span><br><span class="line">   returns [Map&lt;String,String&gt; values]</span><br><span class="line">   locals [int col=0]</span><br><span class="line">	@init &#123;</span><br><span class="line">	$values = new HashMap&lt;String,String&gt;();</span><br><span class="line">	&#125;</span><br><span class="line">	@after &#123;</span><br><span class="line">	if ($values!=null &amp;&amp; $values.size()&gt;0) &#123;</span><br><span class="line">	System.out.println(&quot;values = &quot;+$values);</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	: ...</span><br><span class="line">	;</span><br></pre></td></tr></table></figure>
<p>生成的代码如下，其中动作代码直接拷贝。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CSVParser</span> <span class="keyword">extends</span> <span class="title">Parser</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RowContext</span> <span class="keyword">extends</span> <span class="title">ParserRuleContext</span> </span>&#123;</span><br><span class="line">		<span class="keyword">public</span> String [] columns;</span><br><span class="line">		<span class="keyword">public</span> Map&lt;String,String&gt; values;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">int</span> col=<span class="number">0</span>;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> RowContext <span class="title">row</span><span class="params">(String [] columns)</span> <span class="keyword">throws</span> RecognitionException </span>&#123;</span><br><span class="line">	 	RowContext _localctx = <span class="keyword">new</span> RowContext(_ctx, <span class="number">4</span>, columns);</span><br><span class="line">	 	enterRule(_localctx, RULE_row);</span><br><span class="line">	 	...</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-启动规则和EOF"><a href="#9-启动规则和EOF" class="headerlink" title="9 启动规则和EOF"></a>9 启动规则和EOF</h2><p>启动规则是解析器首先使用的规则，是被语言应用程序调用的规则。</p>
<p>任何规则都可以作为启动规则。启动规则不必处理所有的输入，按需匹配。</p>
<p>如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s : ID</span><br><span class="line">  | ID &apos;+&apos;</span><br><span class="line">  | ID &apos;+&apos; INT</span><br><span class="line">  ;</span><br></pre></td></tr></table></figure>
<p>按照规则匹配，其余部分删除。如a+3匹配第三个选项，结果为a+3;a+b匹配第二个选项，结果为a+;a b匹配第一个选项，结果为a</p>
<p>注意：描述整个输入文件的规则需要使用特殊的标识EOF。否则，对于不匹配的内容提前返回且不会抛出异常。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config : element*; // can &quot;match&quot; even with invalid input.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file : element* EOF; // don&apos;t stop early. must match all input</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ANTLR-4/" rel="tag"># ANTLR 4</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/03/10/210310ANTLR4 语法结构/" rel="next" title="ANTLR 4语法结构">
                <i class="fa fa-chevron-left"></i> ANTLR 4语法结构
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/03/17/210317左侧递归规则/" rel="prev" title="ANTLR 4左侧递归规则">
                ANTLR 4左侧递归规则 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Hopeful Nick" />
            
              <p class="site-author-name" itemprop="name">Hopeful Nick</p>
              <p class="site-description motion-element" itemprop="description">To Explore</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">161</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">42</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/hopefulnick" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:lh848764@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-解析规则"><span class="nav-number">1.</span> <span class="nav-text">1 解析规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-选项标签"><span class="nav-number">2.</span> <span class="nav-text">2 选项标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-规则上下文对象"><span class="nav-number">3.</span> <span class="nav-text">3 规则上下文对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-规则元素标记"><span class="nav-number">4.</span> <span class="nav-text">4 规则元素标记</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-规则元素"><span class="nav-number">5.</span> <span class="nav-text">5 规则元素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-子规则"><span class="nav-number">6.</span> <span class="nav-text">6 子规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-异常捕获"><span class="nav-number">7.</span> <span class="nav-text">7 异常捕获</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-规则属性定义"><span class="nav-number">8.</span> <span class="nav-text">8 规则属性定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-启动规则和EOF"><span class="nav-number">9.</span> <span class="nav-text">9 启动规则和EOF</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">10.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hopeful Nick</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://hopefulnick.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://hopefulnick.github.io/2021/03/11/210311解析规则/';
          this.page.identifier = '2021/03/11/210311解析规则/';
          this.page.title = 'ANTLR 4解析规则';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://hopefulnick.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
